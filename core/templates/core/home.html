{% extends 'core/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/animal_card.css' %}">
<style>
	#animal-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
		gap: 2rem;
		padding: 2rem;
	}

	#loading {
		text-align: center;
		padding: 2rem;
	}

	.chat-message {
		background: #1E1E1E;
		padding: 2rem;
		border-radius: 12px;
		margin-bottom: 2rem;
	}

	.chat-message h2 {
		color: #FFD700;
		margin-bottom: 1rem;
	}

	.chat-message ul li {
		color: white;
		margin-bottom: 0.5rem;
	}
</style>
{% endblock %}

{% block title %}Início{% endblock title %}
{% block content %}
<div class="chat-container">
	<div class="welcome-message chat-message">
		<h1 class="h3">Bem-vindo à AAMA</h1>
		<p>
			Nós somos uma instituição dedicada ao resgate de animais, oferecemos uma
			nova vida a eles.
		</p>
		<p>Adote! Explore os perfis de nossos cães e gatos.</p>
		<div class="text-center">
			<a href="{% url 'animal_list' %}" class="btn btn-primary">Conhecer AAMA</a>
		</div>
	</div>

	<div class="chat-message">
		<h2 class="h4 mb-3">Como ajudar?</h2>
		<div class="help-options">
			<div class="option mb-3">
				<h3 class="h5">Adoção Responsável</h3>
				<p>
					Você sabia que ao adotar um animal você está dando uma nova chance
					para ele? Faça parte dessa mudança.
				</p>
				<a href="{% url 'animal_list' %}" class="btn btn-primary btn-sm">Saber mais</a>
			</div>
			<div class="option mb-3">
				<h3 class="h5">Seja Voluntário</h3>
				<p>
					Temos diversas formas de você ajudar nossos amiguinhos. Venha fazer
					parte do nosso time!
				</p>
				<a href="#" class="btn btn-primary btn-sm">Saber mais</a>
			</div>
			<div class="option">
				<h3 class="h5">Doe</h3>
				<p>
					Sua contribuição é fundamental para mantermos nosso trabalho. Qualquer
					valor faz a diferença!
				</p>
				<a href="#" class="btn btn-primary btn-sm">Saber mais</a>
			</div>
		</div>
	</div>

	<div class="chat-message">
		<h2 class="h4 mb-3">Animais para Adoção</h2>
		<div id="animal-grid">
			<!-- Cards serão carregados aqui via JavaScript -->
		</div>
		<div class="text-center mt-4">
			<div id="loading" class="d-none">
				<div class="spinner-border text-primary" role="status">
					<span class="visually-hidden">Carregando...</span>
				</div>
			</div>
		</div>
	</div>

	<div class="chat-message">
		<h2 class="h4 mb-3">IMPORTANTE!</h2>
		<p>
			Lembre-se que adotar um animal é uma responsabilidade para toda a vida.
			Antes de adotar, considere:
		</p>
		<ul class="list-unstyled">
			<li>✓ Tempo disponível para cuidar do animal</li>
			<li>✓ Espaço adequado em casa</li>
			<li>✓ Condições financeiras para alimentação e cuidados veterinários</li>
			<li>✓ Acordo e apoio de todos que moram com você</li>
		</ul>
	</div>
</div>
{% endblock content %}

{% block extra_js %}
<script src="{% static 'js/likes.js' %}"></script>
<script>
	let page = 1;
	let loading = false;
	let hasMore = true;

	function getIdadeCategoria(idade) {
		if (idade <= 2) return 'Filhote';
		if (idade <= 8) return 'Adulto';
		return 'Sênior';
	}

	function createAnimalCard(animal) {
		const idadeCategoria = getIdadeCategoria(Math.floor(animal.idade_aproximada/12));
		
		return `
		<div class="animal-card">
			<div class="card-image">
				${animal.foto_url 
					? `<img src="${animal.foto_url}" alt="${animal.nome}" class="img-fluid">`
					: `<img src="{% static 'images/no-photo.png' %}" alt="Sem foto" class="img-fluid">`
				}
			</div>
			<div class="card-content">
				<div class="card-header">
					<h3 class="animal-name">${animal.nome}</h3>
					<span class="animal-type">${animal.tipo}</span>
				</div>

				<div class="likes-section">
					<button class="like-button" data-animal-id="${animal.id}">
						<i class="far fa-heart"></i>
					</button>
					<span class="likes-count">${animal.likes_count || 0} likes</span>
				</div>

				<p class="animal-description">
					${animal.descricao || ''}
				</p>

				<div class="characteristics">
					<span class="characteristic-badge">${idadeCategoria}</span>
					<span class="characteristic-badge">${animal.genero}</span>
					${animal.tipo === 'CACHORRO' ? `<span class="characteristic-badge">${animal.porte}</span>` : ''}
					<span class="characteristic-badge">Pelo ${animal.pelagem.toLowerCase()}</span>
				</div>

				<a href="/animal/${animal.id}/" class="conhecer-button">
					Conhecer ${animal.nome}
				</a>
			</div>
		</div>`;
	}

	function loadAnimals() {
		if (loading || !hasMore) return;

		loading = true;
		document.getElementById("loading").classList.remove("d-none");

		fetch(`/api/animals/?page=${page}`)
			.then((response) => response.json())
			.then((data) => {
				const grid = document.getElementById("animal-grid");

				data.animals.forEach((animal) => {
					const cardHtml = createAnimalCard(animal);
					grid.insertAdjacentHTML('beforeend', cardHtml);
				});

				hasMore = data.has_next;
				if (hasMore) page++;

				loading = false;
				document.getElementById("loading").classList.add("d-none");

				// Initialize like buttons for new cards
				initializeLikeButtons();
			})
			.catch((error) => {
				console.error("Erro ao carregar animais:", error);
				loading = false;
				document.getElementById("loading").classList.add("d-none");
			});
	}

	// Infinite scroll
	window.addEventListener("scroll", () => {
		if (
			window.innerHeight + window.scrollY >=
			document.documentElement.scrollHeight - 100
		) {
			loadAnimals();
		}
	});

	// Carrega os primeiros animais
	document.addEventListener("DOMContentLoaded", loadAnimals);
</script>
{% endblock extra_js %}
